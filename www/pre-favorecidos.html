<!DOCTYPE html>

<html> 

<head>
    <meta charset="utf-8" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="msapplication-tap-highlight" content="no" />
    <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width" />
    
   <meta http-equiv="Content-Security-Policy" content="default-src 'self' gap:; script-src * data: https://ssl.gstatic.com 'unsafe-inline' 'unsafe-eval'; object-src *; style-src *; img-src 'self' data:; media-src 'self' data:; font-src *; connect-src *">
    

    
    <link href="https://fonts.googleapis.com/css?family=Mouse+Memoirs|Ubuntu:400,500,700,700i" rel="stylesheet">
    

    <link rel="stylesheet" type="text/css" href="css/jqmcss.css" />
    <title>Tribunal de Contas</title>
</head>

<body>
    <div data-role="page" id="pre-favorecidos">
        <header data-role="header" data-position="fixed">
            <h3>Favorecido</h3>
            <a href="#" data-transition="fade" data-rel="back" id="menu" data-position-to="#menu" data-role="button" data-icon="arrow-l" data-iconshadow="false" data-theme="a" data-iconpos="notext"  class="ui-btn-left ui-nodisc-icon az-nodisc">home</a>
        </header>

        <div data-role="main" class="ui-content">
            
            <div>
                <p id="filter"></p>
            </div>
            
            <ul data-icon="false" data-role="listview" id="list_Favorecidos" data-count-theme="b"></ul>

            <p id="list-info">
                <span id="atualizacao"></span> <br /> 
                <span id="fonte"></span> 
            </p>

           
            <!--<form style="display:none;"  id="form_print" data-ajax="false" method="post" action="FPDF/favorecidopdf.php">
                <input type="hidden" name="link" id="print_link"/>
                
            </form>-->

        </div>
      
        <div data-role="footer" data-position="fixed">
            <h1>Fonte | Portal da Transparência</h1>
        </div>



        <script type="text/javascript">

       
            $("#pre-favorecidos").on("pageshow", function()
                {
                    



                    
                    //document.getElementById("usuario").childNodes[0].innerHTML = JSON.parse(sessionStorage.getItem("user-info")).name;    
                    $.mobile.loading("show",{
                        text : 'Carregando...',
                        textVisible : true,
                        theme : 'a',
                        textonly : false

                    });
 
                    $.getJSON('http://www.elohimsystems.com.br/transmpe/php/pre-favorecidos.php?callback=?', {action: "f_select_favorecidos", param1 : sessionStorage.getItem("codigo-municipio"), param2 : sessionStorage.getItem("ano-municipio"), link : sessionStorage.getItem("tipos-de-despesas-link")  }, function(data) 
                        { 

                            if(data[0].keypass == "stop") 
                                {
                                    alert("Aplicativo indisponível no momento..");
                                    navigator.app.exitApp();
                                    return true;
                                }
                              if(data[0].keypass != "1.0.1") 
                                {
                                    alert("Atualize o app para continuar..");
                                    return openExternal("https://play.google.com/store/apps/details?id=tcm.com");
                                }
                            
                            $("#filter").html(sessionStorage.getItem("text-municipio")+' >> '+
                                            data[0]["selecionado"]+' >> '+
                                            data[0]["despesa"] + ' >> ' + 
                                            data[0]["favorecido"] + ' >> ' +  
                                            sessionStorage.getItem('ano-municipio') +  ' >> '+data[0]["total"]);

                             document.getElementById("filter").style.display = "block"; 

                            var dados = data[0]["dados"];
                            var li = "";
                            for(var i = 0, len = dados.length; i < len; i++) 
                                {
                                      li += "<li>" +
                                                "<a href='#'>"+
                                                    "<p class='ui-li-aside'><strong>"+dados[i]['data']+"</strong></p>" + 
                                                    dados[i]['text']+
                                                    "<span class='ui-li-count'>"+dados[i]['valor']+"</span>" +
                                                "</a>" +
                                            "</li>";


                                }
                           
                            var ul = $("#list_Favorecidos");
                            ul.html(li);
                            ul.listview("refresh");
                            ul.trigger("updatelayout");


                            li = "";
                            $.each( $("#list_Favorecidos li"), function(i)
                                {
                                    var xz = $(this).find('a:nth-child(1)').html();
                                    li += "<li>" +
                                            "<a href='#' id='http://municipios.tce.ce.gov.br"+$(this).find("a[href^='/transparencia']").attr("href")+"' class='ui-btn'>" + xz.substr(0,xz.length - 2) + "</a>" +
                                            "<span class='ui-li-count'>"+$(this).find('span').text()+"</span>" +
                                          "</li>";  
                                    
                                });
                            $("#list_Favorecidos li").remove();
                            $("#list_Favorecidos").html(li).listview('refresh')

                            document.getElementById("list-info").style.display = "block";
                            document.getElementById("atualizacao").innerHTML = sessionStorage.getItem("atualizacao");
                            document.getElementById("fonte").innerHTML = "<strong>Fonte : </strong>"+sessionStorage.getItem("fonte");

                            $.mobile.loading("hide"); 
                            

                        }); 


                    $("#list_Favorecidos").on("click", "li", function()
                        {    
                            
                            let options = {
                                            documentSize: 'A4',
                                            type: 'base64'
                                          }
                            alert(options);              
                            pdf.fromData('<html><h1>Hello World</h1></html>', options)
                                .then((base64)=>'ok')   // it will
                                .catch((err)=>console.err(err));




                             /*window.html2pdf.create(
                                "<html><head></head><body><h1>Some</h1><p>html content.</p></body></html>",
                                "~/Documents/test.pdf", // on iOS,
                                // "test.pdf", on Android (will be stored in /mnt/sdcard/at.modalog.cordova.plugin.html2pdf/test.pdf)
                                success,
                                error
                            );
*/

                           /* $.mobile.loading("show",{
                                text : 'Gerando Pdf...',
                                textVisible : true,
                                theme : 'a',
                                textonly : false

                            });

                            $.getJSON('http://192.168.100.7/FPDF/favorecidopdf.php?callback=?',{ link : $(this).find("a").attr("id") }, function(data) 
                                {
                                    $.mobile.loading("hide");
                                    //window.plugins.fileOpener.open("http://192.168.100.7/FPDF/doc.pdf");
                                    //location.href = 'http://192.168.100.7/FPDF/doc.pdf';

                                    /*cordova.plugins.fileOpener2.open(
                                        'http://192.168.100.7/FPDF/doc.pdf', 
                                        'application/pdf', 
                                        { 
                                            error : function(errorObj) { 
                                                alert('Error status: ' + errorObj.status + ' - Error message: ' + errorObj.message); 
                                            },
                                            success : function () {
                                                alert('file opened successfully');              
                                            }
                                        }
                                    );
                                    //cordova.InAppBrowser.open('http://192.168.100.7/FPDF/doc.pdf', '_blank', 'location=yes');
                                    //Downloader.download(options, downloadSuccessCallback, downloadErrorCallback);   

                                }); 



                            /*$("#print_link").val( $(this).find("a").attr('id'));
                            $("#form_print").submit();*/
                            
                        });     




                        
                });
        </script>

   </div> 
</body>
 
</html>
