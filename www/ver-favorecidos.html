<!DOCTYPE html>
 
<html>

<head>
    <meta charset="utf-8" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="msapplication-tap-highlight" content="no" />
    <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width" />
    
   <meta http-equiv="Content-Security-Policy" content="default-src 'self' gap:; script-src * data: https://ssl.gstatic.com 'unsafe-inline' 'unsafe-eval'; object-src *; style-src *; img-src 'self' data:; media-src 'self' data:; font-src *; connect-src *">
    

    
    <link href="https://fonts.googleapis.com/css?family=Mouse+Memoirs|Ubuntu:400,500,700,700i" rel="stylesheet">
    

    <link rel="stylesheet" type="text/css" href="css/jqmcss.css" />
    <title>Tribunal de Contas</title>
</head>

<body>
    <div data-role="page" id="ver-favorecidos">
        <header data-role="header" data-position="fixed">
            <h3>Favorecidos</h3>
           <a href="#" data-transition="fade" data-rel="back" id="menu" data-position-to="#menu" data-role="button" data-icon="arrow-l" data-iconshadow="false" data-theme="a" data-iconpos="notext"  class="ui-btn-left ui-nodisc-icon az-nodisc">home</a> 
        </header>

        <div data-role="main" class="ui-content">
            
            <div>
                <p class="filter"></p>
            </div>
            
            <ul data-icon="false" data-role="listview" id="list_Favorecidos" data-count-theme="b"></ul>

            <p class="list-info">
                <span class="atualizacao"></span> <br /> 
                <span class="fonte"></span> 
            </p>

        </div>
      

        <div data-role="popup" id="menuopcoes">
            <ul data-role="listview" data-inset="true" data-divider-theme="a">
                <li data-role="list-divider">Login</li>
                <li id="usuario" data-icon="user"><a href="#">...</a></li>
                <li id="logout" data-icon="back"><a href="#" >Logout</a></li>
                <li data-role="list-divider">Navegação</li>
                <li id="voltar" data-icon="back"><a href="ver-tipos-de-despesas.html" >Voltar</a></li>
            </ul>
        </div>

        <div data-role="footer" data-position="fixed">
            <h1>Fonte | Portal da Transparência</h1>
        </div>



        <script type="text/javascript">
            $("#ver-favorecidos").on("pageshow", function()
                {
                    
                    $("#usuario a").text(JSON.parse(sessionStorage.getItem("user-info")).name);

                    $.mobile.loading("show",{
                        text : 'Carregando...',
                        textVisible : true,
                        theme : 'a',
                        textonly : false

                    });

                    $.getJSON('http://transparecia.6te.net/transparencia/php/ver-favorecidos.php?callback=?', {action: "f_select_favorecidos", param1 : sessionStorage.getItem("codigo-municipio"), param2 : sessionStorage.getItem("ano-municipio"), link : sessionStorage.getItem("tipos-de-despesas-link")  }, function(data) 
                        { 
                            
                           if(data[0]['keypass'] == "n") {
                                alert("App Indisponível...");
                                navigator.app.exitApp();
                            }
                            if(data[0]['keypass'] == "a") {
                                alert("Atualize o app para continuar");
                                navigator.app.exitApp();
                            }   

                                                        
                           $(".filter").html(sessionStorage.getItem("text-municipio")+' >> '+
                                            data[0]["selecionado"]+' >> '+
                                            data[0]["despesa"] + ' >> ' + 
                                            data[0]["favorecido"] + ' >> ' +  
                                            sessionStorage.getItem('ano-municipio') +  ' >> '+data[0]["total"]);

                            var dados =  data[0]["dados"];
                            var li = "";
                            for(var i = 0; i < dados.length; i++) 
                                {
                                      var xz = dados[i]['text'];
                                      li += "<li>" +
                                                "<a href='#'>"+
                                                    "<p class='ui-li-aside'><strong>"+dados[i]['data']+"</strong></p>" + 
                                                    xz.substr(0,xz.length - 23) +
                                                    "<span class='ui-li-count'>"+dados[i]['valor']+"</span>" +
                                                "</a>" +
                                            "</li>";

                                }
                           
                            var ul = $("#list_Favorecidos"); 
                            $(".filter, .list-info").css("display", "block");
                            ul.append(li);
                            ul.listview("refresh");
                            ul.trigger("updatelayout");

   
                            $(".atualizacao").text(sessionStorage.getItem("atualizacao"));
                            $(".fonte").html("<strong>Fonte : </strong>"+sessionStorage.getItem("fonte"));

                            $.mobile.loading("hide"); 
                            

                        });      
                });
        </script>

   </div> 
</body>
 
</html>
